<h1 class="page-title">Calls</h1>

<div class="filters">
  <label class="field">
    <span class="label">From (YYYY-MM-DD)</span>
    <input class="input" [formControl]="fromCtrl" placeholder="2025-12-01" />
  </label>
</div>

@if (res$ | async; as res) { @if (!res) {
<div class="error">Failed to load calls</div>
} @else {
<div class="meta">
  Page <b>{{ res.page }}</b> / {{ res.totalPages }} • Total: {{ res.totalItems }}
</div>

<div class="table-wrap">
  <table class="table">
    <thead>
      <tr>
        <th class="col-id">ID</th>
        <th>Status</th>
        <th>Scheduled</th>
        <th>Customer</th>
        <th>Agent</th>
        <th>Topic</th>
      </tr>
    </thead>

    <tbody>
      @if (res.items.length === 0) {
      <tr>
        <td class="empty" colspan="6">No calls found.</td>
      </tr>
      } @else { @for (c of res.items; track c.id) {
      <tr class="row">
        <td class="mono">
          <a class="link" [routerLink]="['/calls', c.id]">{{ c.id }}</a>
        </td>
        <td>
          <span class="pill">{{ c.status }}</span>
        </td>
        <td class="muted">{{ c.scheduledAt | date : 'yyyy-MM-dd HH:mm' }}</td>
        <td class="muted">{{ c.customerName || '—' }}</td>
        <td class="muted">{{ c.agentName || '—' }}</td>
        <td class="muted">{{ c.topic || '—' }}</td>
      </tr>
      } }
    </tbody>
  </table>
</div>

<div class="pagination">
  <div class="pagination-left">
    <button class="btn" (click)="setPage(1)" [disabled]="res.page <= 1" aria-label="First page">
      « First
    </button>
    <button
      class="btn"
      (click)="setPage(res.page - 1)"
      [disabled]="res.page <= 1"
      aria-label="Previous page"
    >
      ‹ Prev
    </button>
  </div>

  <div class="pagination-center" aria-label="Page numbers">
    @for (p of pageButtons(res.page, res.totalPages); track p.key) { @if (p.type === 'dots') {
    <span class="dots" aria-hidden="true">…</span>
    } @else {
    <button
      class="btn btn--page"
      [class.is-active]="p.value === res.page"
      (click)="setPage(p.value!)"
      [disabled]="p.value === res.page"
    >
      {{ p.value }}
    </button>
    } }
  </div>

  <div class="pagination-right">
    <button
      class="btn"
      (click)="setPage(res.page + 1)"
      [disabled]="res.page >= res.totalPages"
      aria-label="Next page"
    >
      Next ›
    </button>
    <button
      class="btn"
      (click)="setPage(res.totalPages)"
      [disabled]="res.page >= res.totalPages || res.totalPages <= 1"
      aria-label="Last page"
    >
      Last »
    </button>
  </div>
</div>
} } @else {
<div class="loading">
  <span class="spinner" aria-hidden="true"></span>
  Loading…
</div>
}
